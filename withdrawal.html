<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fruit Wealth Farming - Withdrawal</title>
  <style>
      body {
  font-family: 'Arial', sans-serif;
  margin: 0;
  padding: 0;
  background-color: #f5f5f5;
  Text-align: center;
}

.container {
  width: 100%;
  margin: 50px auto;
  padding: 0px;
  background-color: none;
  border-radius: 10px;
  
}

h1 {
  text-align: center;
  color: #2a9d8f;
}

.balance-text {
  font-size: 1.2em;
  text-align: center;
  margin: 10px 0;
}

.withdrawal-options {
  display: flex;
  justify-content: space-between;
  
}

.option {
  text-align: center;
  flex: 1;
  margin: 0 10px;
  padding: 2px;
  border: 2px solid #2600ff;
  border-radius: 10px;
  cursor: pointer;
  transition: transform 0.3s, border-color 0.3s;
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.7);
}

.option:hover {
  transform: scale(1.05);
  border-color: #2a9d8f;
}

img {
width: 70px;
  height: 60px;
  margin-bottom: 0px;
   
}

.hidden {
  display: none;
}

form {
  margin-top: 20px;
}

label {
  display: block;
  margin-top: 10px;
}

input {
Position: center;
  width: 80%;
  padding: 10px;
  margin-top: 5px;
  border: 1px solid #2600ff;
  border-radius: 5px;
}

button {
  width: 50%;
  padding: 10px;
  margin-top: 20px;
  background-color: #2a9d8f;
  color: #fff;
  border: none;
  border-radius: 5px;
  cursor: pointer;
  font-size: 1em;
}

button:hover {
  background-color: #21867a;
}

#loading-screen {
  text-align: center;
  font-size: 1.2em;
  color: #555;
}

#notification {
  margin-top: 20px;
  text-align: center;
  padding: 10px;
  border-radius: 5px;
}
h2{
    font-size: 12px;
    Font-weight: bold;
}
P{
    Font-size: 9px;
    Font-weight: bold;
}
footer {
    text-align: center;
    background-color: #2c3e50;
    color: #ecf0f1;
    padding: 20px;
    font-size: 1rem;
    border-top: 3px solid rgba(255, 255, 255, 0.1);
}
  </style>
  
</head>

<body>
  <div class="container">
    <h1>Fruit Wealth Farming</h1>
    <p class="balance-text">Your Withdrawal Balance: <span id="userBalance">₦0.00</span></p>

    <div class="withdrawal-options">
      <div class="option" id="bank-transfer-option">
          <h2>Banks Transfer</h2>
        <img src="wi.png" alt="Bank Transfer">
        
        <p>Network Fee: 7%</p>
        <p>Minimum Withdrawal: ₦500</p>
      </div>
      <div class="option" id="opay-option">
          <h2>OPay Payment</h2>
        <img src="op.png" alt="OPay">
        
        <p>Network Fee: 5%</p>
        <p>Minimum Withdrawal: ₦500</p>
      </div>
    </div>

    <form id="withdrawal-form" class="hidden">
      <h3 id="form-title">Withdraw Funds</h3>
      <label for="amount">Amount (₦):</label>
      <input type="number" id="amount" placeholder="Enter amount" min="500" required>

      <div id="bank-fields" class="hidden">
        <label for="bank-name">Bank Name:</label>
        <input type="text" id="bank-name" placeholder="Enter bank name" required>

        <label for="account-number">Account Number:</label>
        <input type="number" id="account-number" placeholder="Enter account number" required>

        <label for="account-name">Account Name:</label>
        <input type="text" id="account-name" placeholder="Enter account name" required>
      </div>

      <div id="opay-fields" class="hidden">
        <label for="opay-account">OPay Account Number:</label>
        <input type="number" id="opay-account" placeholder="Enter OPay account" required readonly>
      </div>

      <label for="password">Password:</label>
      <input type="password" id="password" placeholder="Enter password" required>

      <button type="submit">Submit</button>
    </form>

    <div id="loading-screen" class="hidden">
      <p>Processing your withdrawal...</p>
    </div>

    <div id="notification" class="hidden"></div>
  </div>
  <style>
    #email-icon {
            position: fixed;
            bottom: 20px;
            right: 2px;
            width: 70px;
            height: 70px;
            Top: 220px;
            
            border-radius: 50%;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            cursor: pointer;
            transition: transform 0.3s ease;
        }

        #email-icon:hover {
            transform: scale(1.1);
        }

        #email-icon img {
            width: 70px;
            height: 70px;
            Border-radius: 50%;
        }
</style>

<div id="email-icon">
    <img src="sup.png" alt="Support Icon">
</div>

<script>
    document.getElementById('email-icon').addEventListener('click', function () {
        const email = 'fruitwealthfarming@gmail.com';
        const subject = encodeURIComponent("Customer Inquiry from Fruit Wealth Farming Invest");
        const body = encodeURIComponent("Dear Fruit Wealth Farming,\n\nI have questions regarding your services. Please assist.\n\nThank you.");
        const mailtoUrl = `mailto:${email}?subject=${subject}&body=${body}`;
        window.location.href = mailtoUrl;
    });
</script>
  <footer>
        <p>&copy; 2024 Fruit Wealth Farming. All rights reserved.</p>
    </footer>
 <script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-app.js";
  import { getDatabase, ref, get, update } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-database.js";
  import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.0.2/firebase-auth.js";

  // Initialize Firebase
  const firebaseConfig = {
    apiKey: "AIzaSyBtwsxKGlpX-ofm-yE4o6_5FNYyKFy7X7w",
    authDomain: "fruit-wealth-farming.firebaseapp.com",
    databaseURL: "https://fruit-wealth-farming-default-rtdb.firebaseio.com",
    projectId: "fruit-wealth-farming",
    storageBucket: "fruit-wealth-farming.appspot.com",
    messagingSenderId: "417203511096",
    appId: "1:417203511096:web:1ecaca3d0a705a8c16ebcd",
    measurementId: "G-BZFLHB4KM2"
  };

  const app = initializeApp(firebaseConfig);
  const db = getDatabase(app);
  const auth = getAuth(app);

  // DOM Elements
  const userBalanceElem = document.getElementById("userBalance");
  const withdrawalForm = document.getElementById("withdrawal-form");
  const bankFields = document.getElementById("bank-fields");
  const opayFields = document.getElementById("opay-fields");
  const loadingScreen = document.getElementById("loading-screen");
  const notification = document.getElementById("notification");

  let uid;
  let userBalance = 0;

  onAuthStateChanged(auth, (user) => {
    if (user) {
      uid = user.uid;
      loadUserBalance(uid);
    } else {
      alert("Please log in to proceed.");
    }
  });

  function loadUserBalance(uid) {
    const balanceRef = ref(db, `users/${uid}/userBalance`);
    get(balanceRef).then((snapshot) => {
      if (snapshot.exists()) {
        userBalance = snapshot.val();
        userBalanceElem.textContent = `₦${userBalance.toFixed(2)}`;
      } else {
        userBalanceElem.textContent = "₦0.00";
      }
    });
  }

document.getElementById("bank-transfer-option").addEventListener("click", () => {
  toggleForm("Bank Transfer");
});

document.getElementById("opay-option").addEventListener("click", () => {
  toggleForm("OPay");
});

function toggleForm(option) {
  withdrawalForm.classList.remove("hidden");
  document.getElementById("form-title").textContent = `Withdraw via ${option}`;
  
  if (option === "Bank Transfer") {
    bankFields.classList.remove("hidden");
    opayFields.classList.add("hidden");
  } else {
    bankFields.classList.add("hidden");
    opayFields.classList.remove("hidden");
    document.getElementById("opay-account").value = "OPay";
  }
}
  withdrawalForm.addEventListener("submit", async (e) => {
    e.preventDefault();

    const amount = parseFloat(document.getElementById("amount").value);
    const password = document.getElementById("password").value;
    const bankName = document.getElementById("bank-name").value;
    const accountNumber = document.getElementById("account-number").value;
    const accountName = document.getElementById("account-name").value;

    if (amount < 500) {
      notify("Minimum withdrawal amount is ₦500.", "error");
      return;
    }

    if (amount > userBalance) {
      notify(`Sorry, your balance is ₦${userBalance}.`, "error");
      return;
    }

    const userConfirmed = confirm(
      `Are you sure to transfer ₦${amount} to ${accountNumber} (${accountName} - ${bankName})?`
    );

    if (!userConfirmed) {
      notify("Withdrawal cancelled by user.", "info");
      return;
    }

    const isValid = await verifyPassword(password);
    if (!isValid) {
      notify("Password does not match.", "error");
      return;
    }

    processWithdrawal(amount, bankName, accountNumber, accountName);
  });

  async function verifyPassword(password) {
    try {
      const user = auth.currentUser;
      const credentials = firebase.auth.EmailAuthProvider.credential(user.email, password);
      await user.reauthenticateWithCredential(credentials);
      return true;
    } catch {
      return false;
    }
  }

  async function processWithdrawal(amount, bankName, accountNumber, accountName) {
    loadingScreen.classList.remove("hidden");
    
const fee = bankName ? 0.07 : 0.05;
  const finalAmount = amount - (amount * fee);
      
    const payload = {
      account_number: accountNumber,
      bank_code: getBankCode(bankName),
      amount: finalAmount * 100, // Convert to kobo
      currency: "NGN",
      description: "User withdrawal",
      account_name: accountName
    };

    try {
      const response = await fetch("https://api.squad.co/v1/withdrawals", {
        method: "POST",
        headers: {
          "Authorization": `Bearer sk_1fd82d88361a0cad8cd7aac43f92e4c6a24b7dbe`,
          "Content-Type": "application/json"
        },
        body: JSON.stringify(payload)
      });

      const result = await response.json();

      if (response.ok) {
        updateBalance(amount);
        saveTransaction(result);
        notify("Withdrawal successful!", "success");
      } else {
        notify(result.message || "Withdrawal failed. Try again later.", "error");
      }
    } catch (error) {
      console.error("Error:", error);
      notify("An error occurred during withdrawal. Try again.", "error");
    } finally {
      loadingScreen.classList.add("hidden");
    }
  }

  function updateBalance(amount) {
    const newBalance = userBalance - amount;
    update(ref(db, `users/${uid}`), { userBalance: newBalance });
    loadUserBalance(uid);
  }

  function saveTransaction(data) {
    const transactionRef = ref(db, `users/${uid}/transactions`);
    update(transactionRef, {
      [data.id]: {
        date: new Date().toLocaleString(),
        amount: data.amount / 100,
        accountNumber: data.account_number,
        bankName: data.bank_code,
        status: "Successful"
      }
    });
  }

  function notify(message, type) {
    notification.textContent = message;
    notification.className = type;
    notification.classList.remove("hidden");
    setTimeout(() => notification.classList.add("hidden"), 5000);
  }

  function getBankCode(bankName) {
    const bankCodes = {
      "GTBank": "058",
      "Access Bank": "044",
      "Wema Bank": "035",
      "OPay": "035", 
       "Ecobank": "050",
    "Fidelity Bank": "070",
    "First Bank": "011",
    "FCMB": "214",
    "GTBank": "058",
    "Heritage Bank": "030",
    "Jaiz Bank": "301",
    "Keystone Bank": "082",
    "Polaris Bank": "076",
    "Stanbic IBTC Bank": "221",
    "Standard Chartered Bank": "068",
    "Sterling Bank": "232",
    "SunTrust Bank": "100",
    "Union Bank": "032",
    "UBA": "033",
    "Unity Bank": "215",
    "Wema Bank": "035",
    "Zenith Bank": "057",
    "Providus Bank": "101",
    "Parallex Bank": "526",
    "Globus Bank": "00103",
    "Titan Trust Bank": "102",
    };

    return bankCodes[bankName] || "000"; // Default code if bank not found
  }
</script>

</body>

</html>
